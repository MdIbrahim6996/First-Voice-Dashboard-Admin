import{r as a,e as ne,u as i,j as s,m as p,M as ce,f as de}from"./index-DodWdPz7.js";import{C as ie,F as pe,a as xe}from"./index-qsRjlaEg.js";import{u as ue}from"./useMutation-hiPJ6IwI.js";import{g as me}from"./status-6ifOY_sE.js";import{d as he,g as ye}from"./lead-DxPnP4UC.js";import{g as fe}from"./process-nPqXU2SE.js";import{g as be}from"./user-DXMVRT2F.js";import{D as Ne}from"./DeleteModal-CgHvfu17.js";import{E as ge,L as je,g as ve}from"./LeadDetailModal-BgFc4j74.js";import{L as Ce}from"./Loader-DZc2yNC9.js";import{E as we}from"./EmptyState-CrWfoHli.js";import"./index-SeQtBOfL.js";import"./index-Dwi2_vPN.js";import"./plan-CqCSfXHT.js";const Be=()=>{const[b,N]=a.useState(""),[g,j]=a.useState(0),[v,C]=a.useState(0),[w,k]=a.useState(0),[H,U]=a.useState(0),[D,E]=a.useState(""),[S,A]=a.useState(""),[L,P]=a.useState(""),[M,F]=a.useState(0),[R,T]=a.useState({}),[Y,z]=a.useState(),O=a.useRef(null),$=a.useRef(null),Q=a.useRef(null);a.useEffect(()=>{const e=O.current,t=$.current;if(!e||!t)return;const o=()=>t.scrollLeft=e.scrollLeft,l=()=>e.scrollLeft=t.scrollLeft;return e.addEventListener("scroll",o),t.addEventListener("scroll",l),()=>{e.removeEventListener("scroll",o),t.removeEventListener("scroll",l)}});const[x,n]=a.useState({edit:!1,delete:!1,view:!1}),[c,u]=a.useState(1),X=30,B=ne(),{data:G}=i({queryKey:["process"],queryFn:fe}),{data:q}=i({queryKey:["user"],queryFn:be}),W=q?.filter(e=>e?.role==="user"),I=q?.filter(e=>e?.role==="closer"||e?.role==="verifier"),{data:J}=i({queryKey:["status"],queryFn:me}),{data:m,refetch:h,isLoading:Z,isFetching:K}=i({queryKey:["leads",M,c],queryFn:()=>ye(M,b,g,v,w,H,D,S,L,c,X),placeholderData:!0}),r=m?.leads,ee=Array.from({length:m?.totalPages},(e,t)=>t+1),{mutate:se}=ue({mutationFn:e=>he(e),onSuccess:()=>{B.invalidateQueries({queryKey:["leads"]})}}),V=r?.map(e=>e?.id)??[],{data:y}=i({queryKey:["allAppliances",c],queryFn:()=>ve(V),enabled:V?.length>0}),d=r?.map(e=>{let t=[];for(let l=0;l<y?.length;l++)y[l]?.leadId===e?.id&&t.push(y[l]);const o={};return t.forEach((l,oe)=>{const f=oe+1;o[`name_${f}`]=l.name?.toUpperCase(),o[`make_${f}`]=l.makeOfAppliance?.toUpperCase(),o[`age_${f}`]=l.age}),{status:e?.status?.name?.toUpperCase(),saleDate:e?.saleDate?.substring(0,10),leadBy:e?.leadBy?.alias?.toUpperCase(),closer:e?.closer?.alias?.toUpperCase(),centre:e?.centre?.toUpperCase(),title:e?.title?.toUpperCase(),firstName:e?.firstName?.toUpperCase(),middleName:e?.middleName?.toUpperCase(),lastName:e?.lastName?.toUpperCase(),address:e?.address,city:e?.city?.toUpperCase(),county:e?.county?.toUpperCase(),post:e?.pincode,dateOfBirth:e?.dateOfBirth?.substring(0,10),password:e?.password,phone:e?.phone?.toString(),process:e?.process?.name?.toUpperCase(),plan:e?.plan?.name?.toUpperCase(),paymentMethod:e?.paymentMethod?.toUpperCase(),bankName:e?.bankName?.toUpperCase(),accountName:e?.accountName?.toUpperCase(),accountNumber:e?.accountNumber?.split(" ").join(""),sort:e?.sort?.split(" ").join(""),cardName:e?.cardName?.toUpperCase(),cardBankName:e?.cardBankName?.toUpperCase(),cardNumber:e?.cardNumber,cardCvv:e?.cardCvv,expiry:e?.expiry,comment:e?.comment,appliances:o,appliancesLength:t?.length}}),ae=d&&d.length>0?Math.max(...d.map(e=>e.appliancesLength||0)):0,te=[{label:"STATUS",key:"status"},{label:"SALE DATE",key:"saleDate"},{label:"LEAD USER",key:"leadBy"},{label:"CLOSER",key:"closer"},{label:"CENTRE",key:"centre"},{label:"TITLE",key:"title"},{label:"FIRST NAME",key:"firstName"},{label:"MIDDLE NAME",key:"middleName"},{label:"LAST NAME",key:"lastName"},{label:"ADDRESS",key:"address"},{label:"CITY",key:"city"},{label:"COUNTY",key:"county"},{label:"POST CODE",key:"post"},{label:"DATE OF BIRTH",key:"dateOfBirth"},{label:"PASSWORD",key:"password"},{label:"PHONE",key:"phone"},{label:"PROCESS",key:"process"},{label:"PLAN",key:"plan"},{label:"PAYMENT METHOD",key:"paymentMethod"},{label:"BANK NAME",key:"bankName"},{label:"ACCOUNT NAME",key:"accountName"},{label:"ACCOUNT NUMBER",key:"accountNumber"},{label:"SORT",key:"sort"},{label:"NAME ON CARD",key:"cardName"},{label:"CARD NUMBER",key:"cardNumber"},{label:"CARD EXPIRY",key:"expiry"},{label:"CARD CVV",key:"cardCvv"},{label:"COMMENT",key:"comment"}],_=[];for(let e=0;e<ae;e++)_.push({label:`APPLIANCE NAME ${e+1}`,key:`appliances.name_${e+1}`},{label:`APPLIANCE MAKE ${e+1}`,key:`appliances.make_${e+1}`},{label:`APPLIANCE AGE ${e+1}`,key:`appliances.age_${e+1}`});const le=[...te,..._],re=()=>{N(""),k(0),C(0),U(0),F(0),j(0),E(""),A(""),P(""),h()};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-hidden",children:s.jsxs("div",{className:"p-5",children:[s.jsxs(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,delay:0},children:[s.jsxs("div",{className:"grid grid-cols-4 gap-x-5 gap-y-3",children:[s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"phone",children:"Phone"}),s.jsx("input",{autoComplete:"off",type:"text",name:"phone",placeholder:"PHONE",value:b,onChange:e=>N(e?.target?.value),onKeyDown:e=>{e.key==="Enter"&&h()},id:"phone",className:"border border-gray-400 px-3 py-1 rounded-md outline-none"})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"process",children:"Process"}),s.jsxs("select",{name:"process",id:"process",onChange:e=>j(e.target.value),value:g,className:"border outline-none border-gray-400 px-3 py-1 rounded-md",children:[s.jsx("option",{value:0,selected:!0,disabled:!0,children:"Select A Process"}),G?.map(e=>s.jsx("option",{value:e?.id,children:e?.name?.toUpperCase()},e?.id))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"leadUser",children:"Lead User"}),s.jsxs("select",{name:"leadUser",id:"leadUser",value:v,onChange:e=>C(e?.target?.value),className:"border outline-none border-gray-400 px-3 py-1 rounded-md",children:[s.jsx("option",{value:0,selected:!0,disabled:!0,children:"Select Lead User"}),W?.map(e=>s.jsx("option",{value:e?.id,className:"uppercase",children:e?.alias},e?.id))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"closerUser",children:"Closer User"}),s.jsxs("select",{name:"closerUser",value:w,onChange:e=>k(e?.target?.value),id:"closerUser",className:"border outline-none border-gray-400 px-3 py-1 rounded-md",children:[s.jsx("option",{value:0,selected:!0,disabled:!0,children:"Select Closer User"}),I?.map(e=>s.jsx("option",{value:e?.id,className:"uppercase",children:e?.alias},e?.id))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"verifierUser",children:"Verifier User"}),s.jsxs("select",{name:"verifierUser",onChange:e=>U(e?.target?.value),id:"verifierUser",className:"border outline-none border-gray-400 px-3 py-1 rounded-md",children:[s.jsx("option",{value:0,selected:!0,disabled:!0,children:"Select Verifier User"}),I?.map(e=>s.jsx("option",{value:e?.id,className:"uppercase",children:e?.alias},e?.id))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"saleDate",children:"Sale Date"}),s.jsx("input",{type:"date",name:"saleDate",value:D,id:"saleDate",onChange:e=>E(e.target.value),className:"border border-gray-400 px-3 py-1 rounded-md outline-none"})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"fromDate",children:"From Date"}),s.jsx("input",{type:"date",name:"fromDate",value:S,id:"fromDate",onChange:e=>A(e.target.value),className:"border border-gray-400 px-3 py-1 rounded-md outline-none"})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"toDate",children:"To Date"}),s.jsx("input",{type:"date",name:"toDate",value:L,id:"toDate",onChange:e=>P(e.target.value),className:"border border-gray-400 px-3 py-1 rounded-md outline-none"})]})]}),s.jsxs("div",{className:"mb-10 mt-3 flex items-center gap-2 text-sm",children:[s.jsx("button",{onClick:()=>h(),className:"bg-green-500 text-white px-10 py-1 rounded-md cursor-pointer",children:"Search"}),s.jsx("button",{onClick:re,className:"bg-sky-500 text-white px-10 py-1 rounded-md cursor-pointer",children:"Reset Filters"})]})]}),s.jsx("div",{className:"mb-5  text-gray-900 bg-white ",children:s.jsx(p.p,{initial:{opacity:0,scale:1.2},animate:{opacity:1,scale:1},transition:{duration:.5},className:"text-3xl font-semibold uppercase origin-center w-fit",children:"Leads - All New Leads"})}),s.jsx(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.25},className:"mt-1 text-sm font-normal text-gray-700 w-full",children:s.jsxs("div",{className:"flex mb-5 items-center justify-between",children:[s.jsx("div",{className:"flex gap-x-1",children:J?.map(e=>s.jsx("button",{onClick:()=>{F(e?.id),B.invalidateQueries({queryKey:["leads"]})},className:`${e?.name.toLowerCase()==="success"?"bg-green-500":""} ${e?.name.toLowerCase()==="cancelled"?"bg-red-500":""} ${e?.name.toLowerCase()==="pending"?"bg-yellow-500":""} ${e?.name.toLowerCase()==="rework/warmup"?"bg-sky-500":""} bg-gray-500 text-white text-xs font-semibold px-6 py-1 rounded-md capitalize cursor-pointer`,children:e?.name},e?.id))}),s.jsx(ie,{headers:le,data:d||[],filename:"Leads.csv",children:s.jsxs("button",{className:"py-1.5 px-7 bg-green-700 text-white rounded-md text-sm flex gap-1 items-center cursor-pointer",children:[s.jsx(pe,{className:"text-lg"})," Export as CSV"]})})]})}),s.jsxs(p.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.5},className:"relative overflow-x-auto shadow-md sm:rounded-lg w-full",children:[s.jsx("div",{ref:O,style:{overflowX:"auto",overflowY:"hidden",height:"20px"},children:s.jsx("div",{style:{width:"2000px",height:"1px"}})}),s.jsxs("div",{ref:$,style:{overflowX:"auto",overflowY:"hidden",width:"100%"},children:[(Z||K)&&s.jsx(Ce,{}),r?.length>0&&!K&&s.jsxs("table",{ref:Q,className:"text-sm text-left rtl:text-right text-gray-500",children:[s.jsx("thead",{className:"text-center text-gray-700 uppercase bg-gray-200",children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Sr. No."}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Actions"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"status"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Sale Date"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Lead By"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Closed By"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Verified By"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Name"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Phone"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Process"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Plan"})]})}),s.jsx("tbody",{children:r?.map((e,t)=>s.jsxs("tr",{className:"text-slate-800 font-semibold capitalize text-center border-b :border-gray-700 border-gray-200",children:[s.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap :text-white",children:t+1}),s.jsxs("td",{className:"px-6 py-4 flex flex-col gap-1 items-center",children:[s.jsx("button",{onClick:()=>{n({edit:!0,delete:!1,view:!1}),T(e)},className:"font-medium text-white bg-green-500 rounded-md w-fit px-2 py-1 text-sm flex items-center gap-1 cursor-pointer",children:s.jsx(ce,{})}),s.jsx("button",{onClick:()=>{T(e),n({edit:!1,delete:!1,view:!0})},className:"font-medium text-white bg-blue-500 rounded-md w-fit px-2 py-1 text-sm flex items-center gap-1 cursor-pointer",children:s.jsx(xe,{})}),s.jsx("button",{onClick:()=>{z(e?.id),n({edit:!1,delete:!0,view:!1})},className:"font-medium text-white bg-red-500 rounded-md w-fit px-2 py-1 text-sm flex items-center gap-1 cursor-pointer",children:s.jsx(de,{})})]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("p",{className:`${e?.status?.name?.toLowerCase()==="success"?"bg-green-500":""} ${e?.status?.name?.toLowerCase()==="pending"?"bg-yellow-500":""} ${e?.status?.name?.toLowerCase()==="cancelled"?"bg-red-500":""} ${e?.status?.name?.toLowerCase()==="rework/warmup"?"bg-sky-500":""} px-3 py-1 text-xs rounded font-semibold text-white`,children:e?.status?.name})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap uppercase",children:new Date(e?.saleDate).toDateString()}),s.jsx("td",{className:"px-6 py-4 uppercase",children:e?.leadBy?.alias}),s.jsx("td",{className:"px-6 py-4 uppercase",children:e?.closer?.alias}),s.jsx("td",{className:"px-6 py-4 uppercase",children:e?.verifier?.alias}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowra uppercase",children:[e?.title," ",e?.firstName," ",e?.middleName," ",e?.lastName]}),s.jsx("td",{className:"px-6 py-4",children:e?.phone}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap uppercase",children:e?.process?.name}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap uppercase",children:e?.plan?.name})]},e?.id))})]}),(!r||r.length===0)&&s.jsx(we,{})]})]}),r?.length>0&&s.jsxs("div",{className:"flex gap-2 mt-4 items-center w-fit mx-auto",children:[s.jsx("button",{disabled:c===1,onClick:()=>u(e=>Math.max(e-1,1)),className:"bg-red-500 text-white text-xs font-semibold px-6 py-1 rounded-md capitalize cursor-pointer disabled:cursor-not-allowed",children:"Prev"}),ee?.map(e=>s.jsx("button",{onClick:()=>u(e),className:`text-xs font-semibold  px-6 py-1 rounded-md capitalize cursor-pointer ${e===c?"bg-sky-500 text-white":"bg-white text-black border border-slate-400"}`,children:e},e)),s.jsx("button",{disabled:c===m?.totalPages,onClick:()=>u(e=>e+1),className:"bg-blue-700 text-white text-xs font-semibold px-6 py-1 rounded-md capitalize cursor-pointer disabled:cursor-not-allowed",children:"Next"})]})]})}),x.delete&&s.jsx(Ne,{handleClose:()=>n({edit:!1,view:!1,delete:!1}),handleDelete:()=>se(Y)}),x.edit&&s.jsx(ge,{handleClose:()=>n({edit:!1,view:!1,delete:!1}),item:R}),x.view&&s.jsx(je,{handleClose:()=>n({edit:!1,view:!1,delete:!1}),details:R})]})};export{Be as default};
