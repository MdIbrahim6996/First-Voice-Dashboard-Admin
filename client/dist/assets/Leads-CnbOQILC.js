import{r as a,e as ee,u as n,j as s,m as c,M as se,f as ae}from"./index-DodWdPz7.js";import{C as te,F as le,a as re}from"./index-qsRjlaEg.js";import{u as oe}from"./useMutation-hiPJ6IwI.js";import{g as ne}from"./status-6ifOY_sE.js";import{d as ce,g as de}from"./lead-DxPnP4UC.js";import{g as ie}from"./process-nPqXU2SE.js";import{g as pe}from"./user-DXMVRT2F.js";import{D as xe}from"./DeleteModal-CgHvfu17.js";import{E as ue,L as me}from"./LeadDetailModal-BgFc4j74.js";import{L as he}from"./Loader-DZc2yNC9.js";import{E as ye}from"./EmptyState-CrWfoHli.js";import"./index-SeQtBOfL.js";import"./index-Dwi2_vPN.js";import"./plan-CqCSfXHT.js";const Ae=()=>{const[u,m]=a.useState(""),[h,y]=a.useState(0),[f,b]=a.useState(0),[N,g]=a.useState(0),[$,j]=a.useState(0),[v,C]=a.useState(""),[w,k]=a.useState(""),[D,U]=a.useState(""),[S,E]=a.useState(0),[L,A]=a.useState({}),[K,I]=a.useState(),F=a.useRef(null),M=a.useRef(null),Y=a.useRef(null);a.useEffect(()=>{const e=F.current,t=M.current;if(!e||!t)return;const q=()=>t.scrollLeft=e.scrollLeft,V=()=>e.scrollLeft=t.scrollLeft;return e.addEventListener("scroll",q),t.addEventListener("scroll",V),()=>{e.removeEventListener("scroll",q),t.removeEventListener("scroll",V)}});const[d,l]=a.useState({edit:!1,delete:!1,view:!1}),[o,i]=a.useState(1),z=30,R=ee(),{data:H}=n({queryKey:["process"],queryFn:ie}),{data:T}=n({queryKey:["user"],queryFn:pe}),Q=T?.filter(e=>e?.role==="user"),P=T?.filter(e=>e?.role==="closer"||e?.role==="verifier"),{data:X}=n({queryKey:["status"],queryFn:ne}),{data:p,refetch:x,isLoading:W,isFetching:O}=n({queryKey:["leads",S,o],queryFn:()=>de(S,u,h,f,N,$,v,w,D,o,z),placeholderData:!0}),r=p?.leads,_=Array.from({length:p?.totalPages},(e,t)=>t+1),{mutate:G}=oe({mutationFn:e=>ce(e),onSuccess:()=>{R.invalidateQueries({queryKey:["leads"]})}}),B=r?.map(e=>({status:e?.status?.name?.toUpperCase(),saleDate:e?.saleDate?.substring(0,10),leadBy:e?.leadBy?.alias?.toUpperCase(),closer:e?.closer?.alias?.toUpperCase(),centre:e?.centre?.toUpperCase(),title:e?.title?.toUpperCase(),firstName:e?.firstName?.toUpperCase(),middleName:e?.middleName?.toUpperCase(),lastName:e?.lastName?.toUpperCase(),address:e?.address,city:e?.city?.toUpperCase(),county:e?.county?.toUpperCase(),post:e?.pincode,dateOfBirth:e?.dateOfBirth?.substring(0,10),password:e?.password,phone:e?.phone?.toString(),process:e?.process?.name?.toUpperCase(),plan:e?.plan?.name?.toUpperCase(),paymentMethod:e?.paymentMethod?.toUpperCase(),bankName:e?.bankName?.toUpperCase(),accountName:e?.accountName?.toUpperCase(),accountNumber:e?.accountNumber?.toUpperCase(),sort:e?.sort?.toUpperCase(),cardName:e?.cardName?.toUpperCase(),cardBankName:e?.cardBankName?.toUpperCase(),cardNumber:e?.cardNumber,cardCvv:e?.cardCvv,expiry:e?.expiry,comment:e?.comment})),J=[{label:"STATUS",key:"status"},{label:"SALE DATE",key:"saleDate"},{label:"LEAD USER",key:"leadBy"},{label:"CLOSER",key:"closer"},{label:"CENTRE",key:"centre"},{label:"TITLE",key:"title"},{label:"FIRST NAME",key:"firstName"},{label:"MIDDLE NAME",key:"middleName"},{label:"LAST NAME",key:"lastName"},{label:"ADDRESS",key:"address"},{label:"CITY",key:"city"},{label:"COUNTY",key:"county"},{label:"POST CODE",key:"post"},{label:"DATE OF BIRTH",key:"dateOfBirth"},{label:"PASSWORD",key:"password"},{label:"PHONE",key:"phone"},{label:"PROCESS",key:"process"},{label:"PLAN",key:"plan"},{label:"PAYMENT METHOD",key:"paymentMethod"},{label:"BANK NAME",key:"bankName"},{label:"ACCOUNT NAME",key:"accountName"},{label:"ACCOUNT NUMBER",key:"accountNumber"},{label:"SORT",key:"sort"},{label:"NAME ON CARD",key:"cardName"},{label:"CARD NUMBER",key:"cardNumber"},{label:"CARD EXPIRY",key:"expiry"},{label:"CARD CVV",key:"cardCvv"},{label:"COMMENT",key:"comment"}],Z=()=>{m(""),g(0),b(0),j(0),E(0),y(0),C(""),k(""),U(""),x()};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-hidden",children:s.jsxs("div",{className:"p-5",children:[s.jsxs(c.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,delay:0},children:[s.jsxs("div",{className:"grid grid-cols-4 gap-x-5 gap-y-3",children:[s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"phone",children:"Phone"}),s.jsx("input",{autoComplete:"off",type:"text",name:"phone",placeholder:"PHONE",value:u,onChange:e=>m(e?.target?.value),onKeyDown:e=>{e.key==="Enter"&&x()},id:"phone",className:"border border-gray-400 px-3 py-1 rounded-md outline-none"})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"process",children:"Process"}),s.jsxs("select",{name:"process",id:"process",onChange:e=>y(e.target.value),value:h,className:"border outline-none border-gray-400 px-3 py-1 rounded-md",children:[s.jsx("option",{value:0,selected:!0,disabled:!0,children:"Select A Process"}),H?.map(e=>s.jsx("option",{value:e?.id,children:e?.name?.toUpperCase()},e?.id))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"leadUser",children:"Lead User"}),s.jsxs("select",{name:"leadUser",id:"leadUser",value:f,onChange:e=>b(e?.target?.value),className:"border outline-none border-gray-400 px-3 py-1 rounded-md",children:[s.jsx("option",{value:0,selected:!0,disabled:!0,children:"Select Lead User"}),Q?.map(e=>s.jsx("option",{value:e?.id,className:"uppercase",children:e?.alias},e?.id))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"closerUser",children:"Closer User"}),s.jsxs("select",{name:"closerUser",value:N,onChange:e=>g(e?.target?.value),id:"closerUser",className:"border outline-none border-gray-400 px-3 py-1 rounded-md",children:[s.jsx("option",{value:0,selected:!0,disabled:!0,children:"Select Closer User"}),P?.map(e=>s.jsx("option",{value:e?.id,className:"uppercase",children:e?.alias},e?.id))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"verifierUser",children:"Verifier User"}),s.jsxs("select",{name:"verifierUser",onChange:e=>j(e?.target?.value),id:"verifierUser",className:"border outline-none border-gray-400 px-3 py-1 rounded-md",children:[s.jsx("option",{value:0,selected:!0,disabled:!0,children:"Select Verifier User"}),P?.map(e=>s.jsx("option",{value:e?.id,className:"uppercase",children:e?.alias},e?.id))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"saleDate",children:"Sale Date"}),s.jsx("input",{type:"date",name:"saleDate",value:v,id:"saleDate",onChange:e=>C(e.target.value),className:"border border-gray-400 px-3 py-1 rounded-md outline-none"})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"fromDate",children:"From Date"}),s.jsx("input",{type:"date",name:"fromDate",value:w,id:"fromDate",onChange:e=>k(e.target.value),className:"border border-gray-400 px-3 py-1 rounded-md outline-none"})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{htmlFor:"toDate",children:"To Date"}),s.jsx("input",{type:"date",name:"toDate",value:D,id:"toDate",onChange:e=>U(e.target.value),className:"border border-gray-400 px-3 py-1 rounded-md outline-none"})]})]}),s.jsxs("div",{className:"mb-10 mt-3 flex items-center gap-2 text-sm",children:[s.jsx("button",{onClick:()=>x(),className:"bg-green-500 text-white px-10 py-1 rounded-md cursor-pointer",children:"Search"}),s.jsx("button",{onClick:Z,className:"bg-sky-500 text-white px-10 py-1 rounded-md cursor-pointer",children:"Reset Filters"})]})]}),s.jsx("div",{className:"mb-5  text-gray-900 bg-white ",children:s.jsx(c.p,{initial:{opacity:0,scale:1.2},animate:{opacity:1,scale:1},transition:{duration:.5},className:"text-3xl font-semibold uppercase origin-center w-fit",children:"Leads - All New Leads"})}),s.jsx(c.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.25},className:"mt-1 text-sm font-normal text-gray-700 w-full",children:s.jsxs("div",{className:"flex mb-5 items-center justify-between",children:[s.jsx("div",{className:"flex gap-x-1",children:X?.map(e=>s.jsx("button",{onClick:()=>{E(e?.id),R.invalidateQueries({queryKey:["leads"]})},className:`${e?.name.toLowerCase()==="success"?"bg-green-500":""} ${e?.name.toLowerCase()==="cancelled"?"bg-red-500":""} ${e?.name.toLowerCase()==="pending"?"bg-yellow-500":""} ${e?.name.toLowerCase()==="rework/warmup"?"bg-sky-500":""} bg-gray-500 text-white text-xs font-semibold px-6 py-1 rounded-md capitalize cursor-pointer`,children:e?.name},e?.id))}),s.jsx(te,{headers:J,data:B||[],filename:"Leads.csv",children:s.jsxs("button",{className:"py-1.5 px-7 bg-green-700 text-white rounded-md text-sm flex gap-1 items-center cursor-pointer",children:[s.jsx(le,{className:"text-lg"})," Export as CSV"]})})]})}),s.jsxs(c.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.5},className:"relative overflow-x-auto shadow-md sm:rounded-lg w-full",children:[s.jsx("div",{ref:F,style:{overflowX:"auto",overflowY:"hidden",height:"20px"},children:s.jsx("div",{style:{width:"2000px",height:"1px"}})}),s.jsxs("div",{ref:M,style:{overflowX:"auto",overflowY:"hidden",width:"100%"},children:[(W||O)&&s.jsx(he,{}),r?.length>0&&!O&&s.jsxs("table",{ref:Y,className:"text-sm text-left rtl:text-right text-gray-500",children:[s.jsx("thead",{className:"text-center text-gray-700 uppercase bg-gray-200",children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Sr. No."}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Actions"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"status"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Sale Date"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Lead By"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Closed By"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Verified By"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Name"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Phone"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Process"}),s.jsx("th",{scope:"col",className:"px-6 py-3",children:"Plan"})]})}),s.jsx("tbody",{children:r?.map((e,t)=>s.jsxs("tr",{className:" capitalize text-center border-b :border-gray-700 border-gray-200",children:[s.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap :text-white",children:t+1}),s.jsxs("td",{className:"px-6 py-4 flex flex-col gap-1 items-center",children:[s.jsx("button",{onClick:()=>{l({edit:!0,delete:!1,view:!1}),A(e)},className:"font-medium text-white bg-green-500 rounded-md w-fit px-2 py-1 text-sm flex items-center gap-1 cursor-pointer",children:s.jsx(se,{})}),s.jsx("button",{onClick:()=>{A(e),l({edit:!1,delete:!1,view:!0})},className:"font-medium text-white bg-blue-500 rounded-md w-fit px-2 py-1 text-sm flex items-center gap-1 cursor-pointer",children:s.jsx(re,{})}),s.jsx("button",{onClick:()=>{I(e?.id),l({edit:!1,delete:!0,view:!1})},className:"font-medium text-white bg-red-500 rounded-md w-fit px-2 py-1 text-sm flex items-center gap-1 cursor-pointer",children:s.jsx(ae,{})})]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("p",{className:`${e?.status?.name?.toLowerCase()==="success"?"bg-green-500":""} ${e?.status?.name?.toLowerCase()==="pending"?"bg-yellow-500":""} ${e?.status?.name?.toLowerCase()==="cancelled"?"bg-red-500":""} ${e?.status?.name?.toLowerCase()==="rework/warmup"?"bg-sky-500":""} px-3 py-1 text-xs rounded font-semibold text-white`,children:e?.status?.name})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap uppercase",children:new Date(e?.saleDate).toDateString()}),s.jsx("td",{className:"px-6 py-4 uppercase",children:e?.leadBy?.alias}),s.jsx("td",{className:"px-6 py-4 uppercase",children:e?.closer?.alias}),s.jsx("td",{className:"px-6 py-4 uppercase",children:e?.verifier?.alias}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowra uppercase",children:[e?.title," ",e?.firstName," ",e?.middleName," ",e?.lastName]}),s.jsx("td",{className:"px-6 py-4",children:e?.phone}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap uppercase",children:e?.process?.name}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap uppercase",children:e?.plan?.name})]},e?.id))})]}),(!r||r.length===0)&&s.jsx(ye,{})]})]}),r?.length>0&&s.jsxs("div",{className:"flex gap-2 mt-4 items-center w-fit mx-auto",children:[s.jsx("button",{disabled:o===1,onClick:()=>i(e=>Math.max(e-1,1)),className:"bg-red-500 text-white text-xs font-semibold px-6 py-1 rounded-md capitalize cursor-pointer disabled:cursor-not-allowed",children:"Prev"}),_?.map(e=>s.jsx("button",{onClick:()=>i(e),className:`text-xs font-semibold  px-6 py-1 rounded-md capitalize cursor-pointer ${e===o?"bg-sky-500 text-white":"bg-white text-black border border-slate-400"}`,children:e},e)),s.jsx("button",{disabled:o===p?.totalPages,onClick:()=>i(e=>e+1),className:"bg-blue-700 text-white text-xs font-semibold px-6 py-1 rounded-md capitalize cursor-pointer disabled:cursor-not-allowed",children:"Next"})]})]})}),d.delete&&s.jsx(xe,{handleClose:()=>l({edit:!1,view:!1,delete:!1}),handleDelete:()=>G(K)}),d.edit&&s.jsx(ue,{handleClose:()=>l({edit:!1,view:!1,delete:!1}),item:L}),d.view&&s.jsx(me,{handleClose:()=>l({edit:!1,view:!1,delete:!1}),details:L})]})};export{Ae as default};
